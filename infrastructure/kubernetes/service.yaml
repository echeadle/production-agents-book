apiVersion: v1
kind: Service
metadata:
  name: agent-service
  namespace: production-agents
  labels:
    app: production-agent
  annotations:
    # Prometheus service discovery
    prometheus.io/scrape: "true"
    prometheus.io/port: "8000"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP  # Use LoadBalancer for external access
  selector:
    app: production-agent
  ports:
    - name: metrics
      port: 8000
      targetPort: metrics
      protocol: TCP
  sessionAffinity: None

---
# Headless Service for StatefulSet (if using StatefulSet for agents)
apiVersion: v1
kind: Service
metadata:
  name: agent-headless
  namespace: production-agents
  labels:
    app: production-agent
spec:
  clusterIP: None
  selector:
    app: production-agent
  ports:
    - name: metrics
      port: 8000
      targetPort: metrics
      protocol: TCP

---
# Redis Service
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: production-agents
  labels:
    app: redis
spec:
  type: ClusterIP
  selector:
    app: redis
  ports:
    - name: redis
      port: 6379
      targetPort: 6379
      protocol: TCP
  sessionAffinity: None
